<% include partials/header %>
<%- messages('message', locals) %>

<head>

    <!-- <script>
     //Convert CSV file
     var blobObject = null;

    function createDownloadLink(anchorSelector, str, fileName){

        if(window.navigator.msSaveOrOpenBlob) {
            var fileData = [str];
            blobObject = new Blob(fileData);
            $(anchorSelector).click(function(){
                window.navigator.msSaveOrOpenBlob(blobObject, fileName);
            });
        } else {
            var url = "data:text/plain;charset=utf-8," + encodeURIComponent(str);
            $(anchorSelector).attr("href", url);
        }
    }
    </script> -->

    <script>
    function ConvertToCSV() {
        <% 
            var awardData = new Array();
            awards.forEach(function(award) 
            { 
                var awardItem = new Array();
                awardItem.push( award.fName + ' ' + award.lName);
                awardItem.push( award.IdCount);
                awardData.push(awardItem);
            }) %>
            var awards = <%- JSON.stringify(awardData); %>

        var csv = '';
        awards.forEach(award => 
            {
                for(var i = 0; i < award.length; i++)
                {
                    csv += award[i];
                    if( i < award.length - 1)
                    {
                        csv += ',';
                    }
                }
                csv += '\r\n'
            }
        )

        console.log(csv);
        var filename = 'data.csv';
        var blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
        if (navigator.msSaveBlob) { // IE 10+
            navigator.msSaveBlob(blob, filename);
        } else {
            var link = document.createElement("a");
            if (link.download !== undefined) { // feature detection
                // Browsers that support HTML5 download attribute
                var url = URL.createObjectURL(blob);
                link.setAttribute("href", url);
                link.setAttribute("download", filename);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        }
    }
    </script>

    <!--Load the AJAX API-->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">

        // Load the Visualization API and the corechart package.
        google.charts.load('current', {'packages':['corechart']});

        //Set callback for Bar Chart
        google.charts.setOnLoadCallback(drawBarChart);

        // Callback that creates and populates a data table,instantiates the chart, passes in the data and draws it.
        function drawBarChart() {

            // Create the data table
            var data = new google.visualization.DataTable();
            data.addColumn('string', 'User');
            data.addColumn('number', 'Awards');

            <% 
            var awardData = new Array();
            awards.forEach(function(award) 
            { 
                var awardItem = new Array();
                awardItem.push( award.fName + ' ' + award.lName);
                awardItem.push( award.IdCount);
                awardData.push(awardItem);
            }) %>
            var awardJSON = <%- JSON.stringify(awardData); %>

            data.addRows(awardJSON);

            // Set chart options
            var options = {'title':'User Leaderboard\n(Users that have created at least 1 award)', 
                        'width':800,
                        'height':500,
                        'titleTextStyle': {color: '#224E7A'},
                        'fontSize': '16',
                        'colors': ['#659DBD'],
                        hAxis: {textStyle: {color: '#224E7A'}},
                        vAxis: {textStyle: {color: '#224E7A'}},
                        legend: {textStyle: {color: '#224E7A'}},
                        chartArea: {backgroundColor: {fill: '#FDF7E4',}
                            }};

            // Instantiate and draw our chart, passing in some options.
            var chart = new google.visualization.BarChart(document.getElementById('barChartDiv'));
            chart.draw(data, options);
        }

    </script>
  </head> 

<body>
        <h1>Happy Paws Employee Portal</h1><br>

        <h4>Analytics & Reporting</h4><br>
        
        <p>Filter Data By:</p>
        <a class="btn btn-custom1" href="/users/admin/analytics" role="button">User Leaderboard</a>
        <a class="btn btn-custom1" href="/users/admin/analyticsuserparticipation" role="button">User Participation</a>
        <a class="btn btn-custom1" href="/users/admin/analyticsDept" role="button">Department Leaderboard</a>
        <a class="btn btn-custom1" href="/users/admin/analyticsdeptparticipation" role="button">Department Participation</a>
        <a class="btn btn-custom1" href="/users/admin/analyticsAwardType" role="button">Award Type</a>
        <a class="btn btn-custom1" href="/users/admin/analyticsViewAllAwards" role="button">View All Awards</a>

    <!-- <Div that holds the bar chart -->
    <div id="barChartDiv"></div>

    <div class="csvbutton">
        <a id="export" class="btn btn-custom2" href="javascript:void(0);" onclick="ConvertToCSV()">Export CSV File</a>
    </div>

    <br><br>
</body>

<a class="btn btn-custom1 btn-lg" href="/users/admin/adminmenu" role="button">Back to Admin Main Menu</a><br><br>

<% include partials/footer %>